const pe={title:"Information",closeLabel:"Fermer",okLabel:"Ok",backdrop:!0,keyboard:!0},fe={title:"Confirmer",closeLabel:"Annuler",cancelLabel:"Annuler",confirmLabel:"Confirmer",backdrop:!0,keyboard:!0};function ge({title:e,closeLabel:t,okLabel:n}){const s=document.createElement("div");return s.className="modal fade",s.id="alertBsModal",s.tabIndex=-1,s.setAttribute("aria-labelledby","alertBsModalLabel"),s.setAttribute("aria-hidden","true"),s.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="alertBsModalLabel">${e}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="${t}"></button>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-alert-ok">${n}</button>
                </div>
            </div>
        </div>
    `,s}function a(e,t={}){var u,m,g;if(!((u=window.bootstrap)!=null&&u.Modal)){(m=window.alert)==null||m.call(window,e);return}const n={...pe,...t},s=document.getElementById("alertBsModal");if(s){const f=(g=window.bootstrap)==null?void 0:g.Modal.getInstance(s);f&&f.hide(),s.remove()}const o=ge(n);o.querySelector(".modal-body").innerHTML=typeof e=="string"?e.replace(/\n/g,"<br>"):e,document.body.appendChild(o);const i=new window.bootstrap.Modal(o,{backdrop:n.backdrop,keyboard:n.keyboard}),r=()=>{o.removeEventListener("hidden.bs.modal",r),o.remove()};o.addEventListener("hidden.bs.modal",r,{once:!0});const l=o.querySelector(".btn-alert-ok");l==null||l.addEventListener("click",()=>i.hide(),{once:!0}),i.show()}function ye({title:e,closeLabel:t,confirmLabel:n,cancelLabel:s}){const o=document.createElement("div");return o.className="modal fade",o.id="confirmBsModal",o.tabIndex=-1,o.setAttribute("aria-labelledby","confirmBsModalLabel"),o.setAttribute("aria-hidden","true"),o.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmBsModalLabel">${e}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="${t}"></button>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-confirm-cancel">${s}</button>
                    <button type="button" class="btn btn-danger btn-confirm-ok">${n}</button>
                </div>
            </div>
        </div>
    `,o}function w(e,t={}){var r,l;if(!((r=window.bootstrap)!=null&&r.Modal)){const u=window.confirm?window.confirm(e):!0;return Promise.resolve(u)}const n={...fe,...t},s=document.getElementById("confirmBsModal");if(s){const u=(l=window.bootstrap)==null?void 0:l.Modal.getInstance(s);u&&u.hide(),s.remove()}const o=ye(n);o.querySelector(".modal-body").innerHTML=typeof e=="string"?e.replace(/\n/g,"<br>"):e,document.body.appendChild(o);const i=new window.bootstrap.Modal(o,{backdrop:n.backdrop,keyboard:n.keyboard});return new Promise(u=>{var S,q;let m=!1;const g=()=>{var J,R;o.removeEventListener("hidden.bs.modal",f),(J=o.querySelector(".btn-confirm-ok"))==null||J.removeEventListener("click",v),(R=o.querySelector(".btn-confirm-cancel"))==null||R.removeEventListener("click",k),o.remove()},f=()=>{m||(m=!0,u(!1)),g()},v=()=>{m||(m=!0,u(!0)),i.hide()},k=()=>{m||(m=!0,u(!1)),i.hide()};o.addEventListener("hidden.bs.modal",f,{once:!0}),(S=o.querySelector(".btn-confirm-ok"))==null||S.addEventListener("click",v,{once:!0}),(q=o.querySelector(".btn-confirm-cancel"))==null||q.addEventListener("click",k,{once:!0}),i.show()})}window.alertBs=a;window.confirmBs=w;const d="",I=new URLSearchParams(window.location.search);let Z=I.get("list")||null;function j(){return Z}function ee(e){Z=e}function be(){const e=document.querySelector('meta[name="app:auth"]');let t="",n="",s=null,o=!1;if(e){const l=e.dataset;l&&(t=(l.email||"").trim(),n=(l.sessionEmail||"").trim(),s=l.name||null,o=l.authenticated==="1")}const i=document.querySelector('meta[name="csrf-token"]');i&&(window.csrfToken=i.getAttribute("content"));const r=t||n||"";window.authUser={email:r||null,name:s,isAuthenticated:o},window.userEmail=r,window.isAuthenticated=o,window.sessionEmail=n}function he(){if(typeof window>"u"||typeof window.fetch!="function"||window.fetch.__isAuthenticatedWrapper)return;const e=window.fetch.bind(window);window.fetch=(t,n={})=>{const s={...n};s.credentials=s.credentials||"include";const o=new Headers(s.headers||{});if(o.has("Accept")||o.set("Accept","application/json"),window.csrfToken&&!o.has("X-CSRF-Token")){const i=(s.method||"GET").toUpperCase();i!=="GET"&&i!=="HEAD"&&o.set("X-CSRF-Token",window.csrfToken)}return s.headers=o,e(t,s)},window.fetch.__isAuthenticatedWrapper=!0}function p(){const e=localStorage.getItem("simpleTodo_email");return e?e.trim():""}function $(e){const t=(e||"").trim();t?(localStorage.setItem("simpleTodo_email",t),typeof window<"u"&&(window.userEmail=t)):(localStorage.removeItem("simpleTodo_email"),typeof window<"u"&&(window.userEmail="")),A()}function T(){let e="";if(typeof window<"u"&&window.userEmail&&typeof window.userEmail=="string"&&window.userEmail.trim()!==""&&(e=window.userEmail.trim()),!e){const t=p();t&&(e=t)}return e}function A(){const e=document.querySelectorAll(".user-email");if(!e.length)return;const t=!!(typeof window<"u"&&window.isAuthenticated),n=T();e.forEach(s=>{const o=s.querySelector(".user-email-text");o&&(t&&n?(o.textContent=n,s.style.display="inline-flex",typeof window<"u"&&(window.userEmail=n,window.authUser||(window.authUser={}),window.authUser.email=n,window.authUser.isAuthenticated=!0)):(o.textContent="",s.style.display="none"))})}function we(){return"list_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function te(){const e=T(),t=e?`<span class="badge bg-light text-dark" style="font-size: 0.85rem;">${e}</span>`:"",n=e?`-- Sélectionner une liste pour ${e} --`:"-- Sélectionner une liste --",s=e||"";document.body.innerHTML=`
        <div class="container" style="max-width: 600px; margin: 100px auto;">
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, #8fa4f5 0%, #b491e8 100%); color: white;">
                    <div class="d-flex align-items-center justify-content-between">
                        <h2 class="mb-0"><i class="bi bi-check2-square"></i> SimpleTodo</h2>
                        ${t}
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="mb-4">Choisir ou créer une liste</h5>
                    
                    <div class="mb-4">
                        <label class="form-label">Mes listes</label>
                        <select id="myLists" class="form-select mylists-select">
                            <option value="">${n}</option>
                        </select>
                        <button class="btn btn-primary w-100 mt-2" onclick="loadSelectedList()">
                            <i class="bi bi-box-arrow-in-right"></i> Ouvrir cette liste
                        </button>
                    </div>
                    
                    <hr>
                    
                    <div>
                        <label class="form-label">Créer une nouvelle liste</label>
                        <input type="text" id="newListTitle" class="form-control mb-2" placeholder="Nom de la liste" maxlength="100">
                        <input type="email" id="newListEmail" class="form-control mb-2" placeholder="Votre email (pour être le créateur)" maxlength="255" value="${s}">
                        <small class="text-muted d-block mb-2">Votre email vous donnera les droits de créateur (modifier le thème, supprimer la liste)</small>
                        <button class="btn btn-success w-100" onclick="createNewList()">
                            <i class="bi bi-plus-circle"></i> Créer une nouvelle liste
                        </button>
                    </div>
                    
                    <hr>
                    
                    <div>
                        <label class="form-label">Recevoir un email d'authentification</label>
                        <input type="email" id="authEmail" class="form-control mb-2" placeholder="Votre email" maxlength="255">
                        <small class="text-muted d-block mb-2">Un lien d'authentification vous sera envoyé par email</small>
                        <button class="btn btn-info w-100" onclick="requestAuthEmail()">
                            <i class="bi bi-envelope"></i> Envoyer l'email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,ve()}async function Ee(){const e=[],t=T(),n=t?`-- Sélectionner une liste pour ${t} --`:"-- Sélectionner une liste --";try{const o=await fetch(`${d}/api/mylists`);o.ok?(await o.json()).forEach(r=>{e.push({listId:r.id,title:r.title})}):console.log("Erreur lors du chargement des listes depuis l'API:",o.status)}catch(o){console.error("Erreur lors du chargement des listes depuis l'API:",o)}for(let o=0;o<localStorage.length;o++){const i=localStorage.key(o);if(i.startsWith("simpleTodo_list_")){const r=localStorage.getItem(i),l=JSON.parse(r);l&&l.listId&&(e.find(m=>m.listId===l.listId)||e.push({listId:l.listId,title:l.title||l.listId}))}}return document.querySelectorAll(".mylists-select").forEach(o=>{o.innerHTML=`<option value="">${n}</option>`,e.forEach(i=>{const r=document.createElement("option");r.value=i.listId,r.textContent=i.title,o.appendChild(r)}),e.length===0&&(o.innerHTML='<option value="">Aucune liste disponible</option>')}),e}function ve(){Ee()}async function $e(){const e=document.getElementById("myLists");if(!e)return;const t=e.value;if(t)try{const n=await fetch(`${d}/api/lists/${t}`);if(!n.ok||n.status===404){localStorage.removeItem(`simpleTodo_list_${t}`);for(let s=localStorage.length-1;s>=0;s--){const o=localStorage.key(s);if(o&&o.startsWith("simpleTodo_token_")){const i=JSON.parse(localStorage.getItem(o));i&&i.listId===t&&localStorage.removeItem(o)}}a("Cette liste n'existe plus. Retour à l'accueil."),window.location.href="/";return}window.location.href=`/${t}`}catch(n){console.error("Erreur lors de la vérification de la liste:",n),a("Erreur lors de la vérification de la liste.")}}async function Ce(){const e=document.getElementById("newListTitle"),t=document.getElementById("newListEmail");if(!e)return;const n=e.value.trim();if(!n){a("Veuillez entrer un nom pour la liste");return}const o=(t?t.value.trim():"")||p();if(!o){a("Veuillez entrer votre email pour devenir le créateur de la liste"),t&&t.focus();return}p()||$(o);const i=we();try{(await fetch(`${d}/api/lists/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:n,creator_email:o})})).ok?window.location.href=`/${i}`:a("Erreur lors de la création de la liste")}catch(r){console.error("Erreur:",r),a("Erreur de connexion lors de la création de la liste")}}async function Ie(){const e=document.getElementById("authEmail");if(!e)return;const t=e.value.trim();if(!t||!t.includes("@")){a("Veuillez entrer une adresse email valide");return}try{const n=await fetch(`${d}/api/auth/request-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(n.ok)a("Un email avec vos liens d'authentification a été envoyé !"),e.value="";else{const s=await n.json();a(s.message||"Erreur lors de l'envoi de l'email")}}catch(n){console.error("Erreur:",n),a("Erreur de connexion")}}function Te(){const t=window.location.pathname.match(/^\/([^\/]+)\/([^\/]+)$/);if(t){const n=t[1];return ee(n),{listId:n,token:t[2]}}return null}function Le(){let e=I.get("token");if(e)return e;const t=Te();return t?t.token:null}let h=j();function P(e){h=e}async function y(){try{const t=await(await fetch(`${d}/api/todos/${h}`)).json();ke(t),Be(t)}catch(e){console.error("Erreur lors du chargement des todos:",e)}}function ke(e){const t=document.getElementById("todoList");if(!t)return;if(!e.length){t.innerHTML=`
            <div class="text-center text-muted py-5">
                <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                <p class="mt-3">Aucune tâche pour le moment</p>
            </div>
        `;return}const n=new Map,s=[];e.forEach(i=>{if(i.category){const r=`cat_${i.category.id}`;n.has(r)||n.set(r,{name:i.category.name,color:i.category.color,todos:[]}),n.get(r).todos.push(i)}else s.push(i)});let o="";s.length&&(o+=`
            <div class="mb-3">
                ${s.map(i=>V(i)).join("")}
            </div>
        `),n.size&&(o+='<div class="accordion" id="todoAccordion">',Array.from(n.entries()).sort((r,l)=>{const u=r[1].name.toLowerCase(),m=l[1].name.toLowerCase();return u.localeCompare(m,"fr")}).forEach(([r,l],u)=>{const m=`collapse_${r}`,g=`heading_${r}`,f=u===0&&!s.length,v=l.color||"#6c757d",k=l.todos.map(S=>V(S)).join("");o+=`
                <div class="accordion-item">
                    <h2 class="accordion-header" id="${g}">
                        <button class="accordion-button ${f?"":"collapsed"}" type="button"
                            data-bs-toggle="collapse" data-bs-target="#${m}"
                            aria-expanded="${f?"true":"false"}" aria-controls="${m}">
                            <span class="badge rounded-pill me-2" style="background-color: ${v}; color: #fff;">
                                ${b(l.name)}
                            </span>
                            <span class="ms-1 text-muted">${l.todos.length} tâche${l.todos.length>1?"s":""}</span>
                        </button>
                    </h2>
                    <div id="${m}" class="accordion-collapse collapse ${f?"show":""}"
                        aria-labelledby="${g}" data-bs-parent="#todoAccordion">
                        <div class="accordion-body p-0">
                            ${k}
                        </div>
                    </div>
                </div>
            `}),o+="</div>"),t.innerHTML=o,window.updateCommentBadge&&e.forEach(i=>{window.updateCommentBadge(i.id)})}function V(e){const t=e.comments?e.comments.length:0,n=e.due_date?Se(e.due_date):"Aucune date",s=e.completed?"bi-arrow-counterclockwise":"bi-check-lg",o=e.completed?"Marquer comme non terminé":"Marquer comme terminé",i=e.completed?"btn btn-sm btn-outline-success flex-shrink-0":"btn btn-sm btn-outline-primary flex-shrink-0",r=e.pseudo?`<span class="badge bg-light text-dark pseudo-badge ms-2"><i class="bi bi-person-fill"></i> ${b(e.pseudo)}</span>`:"",l=e.assigned_to?`<span class="badge bg-info text-dark pseudo-badge ms-2"><i class="bi bi-person-check"></i> ${b(e.assigned_to)}</span>`:"",u=e.category?`<span class="badge" style="background-color:${e.category.color};">${b(e.category.name)}</span>`:"",m=t>0?"btn btn-sm btn-outline-primary":"btn btn-sm btn-outline-secondary";return`
        <div class="todo-item ${e.completed?"completed":""}" data-id="${e.id}" data-category="${e.category?e.category.id:""}" data-assigned="${e.assigned_to?b(e.assigned_to):""}" data-due-date="${e.due_date||""}" data-completed="${e.completed?"1":"0"}">
            <div class="d-flex align-items-start gap-2">
                <button class="${i}" title="${o}"
                    onclick="event.stopPropagation(); toggleTodo(${e.id})">
                    <i class="bi ${s}"></i>
                </button>
                <div class="flex-grow-1">
                    <div>
                        <span class="todo-text ${e.completed?"completed":""}">${b(e.text)}</span>
                        ${e.completed?'<span class="badge bg-success ms-2"><i class="bi bi-check-circle"></i> Terminé</span>':""}
                        ${u}
                        ${r}
                        ${l}
                    </div>
                    <div class="text-muted" style="font-size: 0.85rem;">
                        Ajouté par <strong>${b(e.pseudo||"Anonyme")}</strong>
                        • ${n}
                    </div>
                </div>
                <div class="d-flex gap-2 flex-shrink-0">
                    <button id="comment-button-${e.id}" class="${m} btn-comment-wrapper" title="Afficher les commentaires"
                        onclick="event.stopPropagation(); toggleComments(${e.id})">
                        <i class="bi bi-chat-dots"></i>
                        <span class="comment-badge" id="comment-badge-${e.id}" ${t>0?"":'style="display:none;"'}>${t}</span>
                        <span class="comment-badge comment-badge-new d-none" id="comment-new-badge-${e.id}"></span>
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                            id="dropdownMenuButton${e.id}" data-bs-toggle="dropdown" aria-expanded="false"
                            onclick="event.stopPropagation();">
                            <i class="bi bi-three-dots"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton${e.id}">
                            ${e.assigned_to?"":`<li><a class="dropdown-item" href="#" onclick="event.stopPropagation(); assignTodo(${e.id}); return false;"><i class="bi bi-person-plus me-2"></i>Je m'en occupe</a></li>`}
                            <li><a class="dropdown-item" href="#" onclick="event.stopPropagation(); changeCategory(${e.id}); return false;"><i class="bi bi-tag me-2"></i>Changer de catégorie</a></li>
                            <li><a class="dropdown-item" href="#" onclick="event.stopPropagation(); changeDueDate(${e.id}); return false;"><i class="bi bi-calendar-plus me-2"></i>Modifier la date</a></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="event.stopPropagation(); deleteTodo(${e.id}); return false;"><i class="bi bi-trash me-2"></i>Supprimer</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="comments-section" id="comments-${e.id}" style="display: none;">
                <div class="comment-list" id="comments-list-${e.id}"></div>
                <div class="comment-form input-group mt-2">
                    <input type="text" class="form-control" id="comment-input-${e.id}" placeholder="Ajouter un commentaire...">
                    <button class="btn btn-outline-primary" type="button" onclick="addComment(${e.id})">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
            </div>
        </div>
    `}function b(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Se(e){return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}function Be(e){const t=e.length,n=e.filter(l=>l.completed).length,s=t-n,o=document.getElementById("totalCount"),i=document.getElementById("completedCount"),r=document.getElementById("remainingCount");o&&(o.textContent=t),i&&(i.textContent=n),r&&(r.textContent=s)}async function ne(){const e=document.getElementById("todoInput"),t=localStorage.getItem("simpleTodo_pseudo");if(!e)return;const n=e.value.trim();if(!n){a("Veuillez entrer une tâche");return}try{(await fetch(`${d}/api/todos/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,pseudo:t||"Anonyme"})})).ok?(e.value="",y()):a("Erreur lors de l'ajout de la tâche")}catch(s){console.error("Erreur lors de l'ajout de la tâche:",s),a("Erreur de connexion")}}async function xe(e){const t=document.querySelector(`.todo-item[data-id="${e}"]`),s=!((t==null?void 0:t.getAttribute("data-completed"))==="1");try{const o=await fetch(`${d}/api/todos/${h}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:s})});if(o.ok)y();else if(o.status===422){const i=await o.json().catch(()=>null);console.error("Validation toggle todo:",i),a((i==null?void 0:i.message)||"Validation impossible pour cette tâche")}else a("Erreur lors du changement d'état de la tâche")}catch(o){console.error("Erreur toggle todo:",o),a("Erreur de connexion")}}async function _e(e){if(await w("Êtes-vous sûr de vouloir supprimer cette tâche ?"))try{(await fetch(`${d}/api/todos/${h}/${e}`,{method:"DELETE"})).ok?y():a("Erreur lors de la suppression de la tâche")}catch(n){console.error("Erreur suppression todo:",n),a("Erreur de connexion")}}async function Ae(){if(await w("Êtes-vous sûr de vouloir supprimer toutes les tâches terminées ?"))try{(await fetch(`${d}/api/todos/${h}`,{method:"DELETE"})).ok?y():a("Erreur lors de la suppression des tâches terminées")}catch(t){console.error("Erreur clear completed:",t),a("Erreur de connexion")}}async function Me(e){const t=localStorage.getItem("simpleTodo_pseudo")||"",n=typeof window<"u"&&window.userEmail?window.userEmail:T();if(!n){a("Impossible d'assigner la tâche : votre adresse email est introuvable. Veuillez vous reconnecter.");return}let s=t;if(!s&&window.isAuthenticated&&(s=n.split("@")[0],localStorage.setItem("simpleTodo_pseudo",s)),!s){a("Veuillez enregistrer votre pseudo avant de vous assigner une tâche.");return}try{const o=await fetch(`${d}/api/todos/${h}/${e}/assign`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Email":n,"X-User-Pseudo":s},body:JSON.stringify({pseudo:s})});if(o.ok)y();else if(o.status===422){const i=await o.json().catch(()=>null);console.error("Validation assign todo:",i),a(i&&i.message||"Impossible d'assigner la tâche (422)")}else a("Erreur lors de l'assignation de la tâche")}catch(o){console.error("Erreur assign todo:",o),a("Erreur de connexion")}}Object.assign(window,{loadSelectedList:$e,createNewList:Ce,requestAuthEmail:Ie,alertBs:a,confirmBs:w,addTodo:ne,saveTitle:Xe,cancelTitleEdit:Ve,editTitle:Re,subscribe:U,unsubscribe:Qe,inviteCollaborator:me,addCategory:tt,savePseudo:oe,savePseudoFromModal:se,changeHeaderGradient:Pe,saveAutoAssignOption:De,deleteCategory:nt,clearCompleted:Ae,confirmDeleteList:ze,runServerUpdate:Oe,shareListUrl:We,toggleTodo:xe,toggleComments:He,assignTodo:Me,changeCategory:Ne,changeDueDate:Ue,deleteTodo:_e,addComment:le,resendSubscriberLink:Ye,updateCommentBadge:re});be();he();let c=j();P(c);let M=!1,_=!1;if(!c){const t=window.location.pathname.match(/^\/([^\/]+)$/);t&&t[1]&&t[1]!=="index.html"&&(c=t[1],ee(c),P(c))}c||te();function E(){const e=localStorage.getItem("simpleTodo_pseudo"),t=document.getElementById("pseudo");return e&&t?(t.value=e,e):null}function oe(){const e=document.getElementById("pseudo");if(!e)return;const t=e.value.trim();t?(localStorage.setItem("simpleTodo_pseudo",t),L(),new bootstrap.Collapse(document.getElementById("userSettings"),{toggle:!0})):a("Veuillez entrer un pseudo")}function L(){const e=E(),t=p(),n=document.querySelector(".user-pseudo"),s=n?n.querySelector(".user-pseudo-text"):null;n&&s&&e?(s.textContent=e,n.style.display="inline-flex"):n&&(s&&(s.textContent=""),n.style.display="none");const o=document.getElementById("userInfo");if(o&&(o.style.display=e||window.isAuthenticated&&T()?"flex":"none"),t){const i=document.getElementById("emailBadge");i&&(i.style.display="inline-block")}else{const i=document.getElementById("emailBadge");i&&(i.style.display="none")}}const B={gradient1:"linear-gradient(135deg, #8fa4f5 0%, #b491e8 100%)",gradient2:"linear-gradient(135deg, #f66 0%, #ff9240 100%)",gradient3:"linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)",gradient4:"linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)",gradient5:"linear-gradient(135deg, #fd79a8 0%, #e84393 100%)",gradient6:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",gradient7:"linear-gradient(135deg, #fdcb6e 0%, #e17055 100%)",gradient8:"linear-gradient(135deg, #a29bfe 0%, #fd79a8 100%)"};async function je(){let e="gradient1";try{const o=await(await fetch(`${d}/api/lists/${c}`)).json();o.header_gradient&&(e=o.header_gradient)}catch(s){console.error("Erreur chargement gradient:",s)}const t=document.querySelector(".card-header");t&&B[e]&&(t.style.background=B[e]);const n=document.getElementById("headerGradient");n&&(n.value=e)}async function Pe(){const e=document.getElementById("headerGradient").value,t=document.querySelector(".card-header");if(t&&B[e]){t.style.background=B[e];try{await fetch(`${d}/api/lists/${c}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":window.csrfToken},body:JSON.stringify({header_gradient:e})})}catch(n){console.error("Erreur sauvegarde gradient:",n)}}}async function De(){const e=document.getElementById("autoAssignToCreator");if(!e)return;const t=e.checked;window.autoAssignToCreator=t;try{const n=await fetch(`${d}/api/lists/${c}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":window.csrfToken},body:JSON.stringify({auto_assign_to_creator:t})});n.ok||(console.error("Erreur sauvegarde option assignation:",n.statusText),e.checked=!t,window.autoAssignToCreator=!t)}catch(n){console.error("Erreur sauvegarde option assignation:",n),e.checked=!t,window.autoAssignToCreator=!t}}document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("simpleTodo_pseudo");let t=Le();if(c=j(),P(c),t&&c){const i={listId:c,token:t};Q().then(r=>{r&&(i.title=r),localStorage.setItem(`simpleTodo_token_${t}`,JSON.stringify(i))}).catch(r=>{localStorage.setItem(`simpleTodo_token_${t}`,JSON.stringify(i))})}const n=I.get("email");n&&(document.getElementById("email").value=n,localStorage.getItem("simpleTodo_pseudo")&&setTimeout(function(){U()},500)),e||(new bootstrap.Modal(document.getElementById("pseudoModal")).show(),setTimeout(function(){document.getElementById("modalPseudo").focus()},500)),typeof window<"u"&&window.isAuthenticated&&window.userEmail?$(window.userEmail):A(),E(),Q(),je(),L(),A(),H(),y(),N();const s=document.querySelector(".user-pseudo");s&&(s.style.cursor="pointer",s.addEventListener("click",function(){(window.userEmail||p()||"").trim()&&(window.location.href="/")})),setInterval(et,5e3);const o=document.getElementById("userSettings");o&&o.addEventListener("show.bs.collapse",function(){F()})});async function Oe(){const e=document.getElementById("updateOutput"),t=document.getElementById("updateStatus");e&&(e.textContent="Exécution en cours..."),t&&(t.style.display="block",t.textContent="");try{const n=!!(document.getElementById("updateForce")&&document.getElementById("updateForce").checked),s=await fetch(`${d}/api/update`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":window.csrfToken,"X-User-Email":window.userEmail||p()||""},body:JSON.stringify({email:window.userEmail||p()||"",force:n})}),o=await s.json(),i=[];i.push(`Success: ${!!o.success}`),typeof o.code<"u"&&i.push(`Exit code: ${o.code}`),o.stdout&&(i.push(`
--- stdout ---`),i.push(o.stdout)),o.stderr&&(i.push(`
--- stderr ---`),i.push(o.stderr)),e&&(e.textContent=i.join(`
`)),t&&(t.textContent=s.ok?"Mise à jour terminée.":"Erreur lors de la mise à jour.")}catch(n){e&&(e.textContent=`Erreur: ${n}`),t&&(t.textContent="Erreur lors de la mise à jour.")}}function se(){const e=document.getElementById("modalPseudo").value.trim();if(e){localStorage.setItem("simpleTodo_pseudo",e),L();const t=I.get("email");t&&(document.getElementById("email").value=t,setTimeout(function(){U()},300)),bootstrap.Modal.getInstance(document.getElementById("pseudoModal")).hide()}else a("Veuillez entrer un pseudo")}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("modalPseudo");e&&e.addEventListener("keypress",function(t){t.key==="Enter"&&se()})});function C(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function Ue(e){const t=document.querySelector(`[data-id="${e}"]`);if(!t){a("Impossible de récupérer la tâche ciblée. Veuillez recharger la page.");return}const n=t.getAttribute("data-due-date")||"",s=n?new Date(n).toLocaleDateString("fr-FR",{day:"numeric",month:"numeric",year:"numeric"}):"Aucune date",o=document.createElement("div");o.innerHTML=`
        <div class="modal fade" id="dueDateModal" tabindex="-1" aria-labelledby="dueDateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="dueDateModalLabel"><i class="bi bi-calendar-event"></i> Modifier la date d'échéance</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="newDueDate" class="form-label">Nouvelle date</label>
                            <input type="date" class="form-control" id="newDueDate" value="${n}" min="${new Date().toISOString().split("T")[0]}">
                        </div>
                        <p class="text-muted">Date actuelle : ${s}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="removeDueDateBtn">Supprimer la date</button>
                        <button type="button" class="btn btn-primary" id="saveDueDateBtn">Sauvegarder</button>
                    </div>
                </div>
            </div>
        </div>
    `,document.body.appendChild(o);const i=document.getElementById("dueDateModal"),r=new bootstrap.Modal(i);r.show();const l=document.getElementById("newDueDate"),u=document.getElementById("saveDueDateBtn"),m=document.getElementById("removeDueDateBtn"),g=()=>{r.hide(),setTimeout(()=>o.remove(),300)};u.addEventListener("click",async()=>{try{const f=l.value;(await fetch(`${d}/api/todos/${c}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({due_date:f})})).ok?(g(),y()):a("Erreur lors de la modification de la date d'échéance")}catch(f){console.error("Erreur:",f),a("Erreur lors de la modification de la date d'échéance")}}),m.addEventListener("click",async()=>{try{(await fetch(`${d}/api/todos/${c}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({due_date:null})})).ok?(g(),y()):a("Erreur lors de la suppression de la date d'échéance")}catch(f){console.error("Erreur:",f),a("Erreur lors de la suppression de la date d'échéance")}})}async function Ne(e){const n=document.querySelector(`[data-id="${e}"]`).dataset.category||"",s=`
        <div class="modal fade" id="categoryModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Changer la catégorie</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <label class="form-label">Catégorie</label>
                        <select id="categorySelect" class="form-select">
                            <option value="">Aucune catégorie</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" class="btn btn-primary" onclick="saveCategoryChange(${e})">Sauvegarder</button>
                    </div>
                </div>
            </div>
        </div>
    `,o=document.getElementById("categoryModal");o&&o.remove(),document.body.insertAdjacentHTML("beforeend",s);const i=document.getElementById("categorySelect");i.innerHTML='<option value="">Aucune catégorie</option>',x.forEach(l=>{const u=document.createElement("option");u.value=l.id,u.textContent=l.name,u.style.backgroundColor=l.color,u.style.color="white",l.id==n&&(u.selected=!0),i.appendChild(u)});const r=new bootstrap.Modal(document.getElementById("categoryModal"));r.show(),window.saveCategoryChange=async function(l){const u=i.value||null;try{(await fetch(`${d}/api/todos/${c}/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({category_id:u})})).ok?(r.hide(),setTimeout(()=>document.getElementById("categoryModal").remove(),300),y()):a("Erreur lors du changement de catégorie")}catch(m){console.error("Erreur:",m),a("Erreur lors du changement de catégorie")}}}const z=document.getElementById("todoInput");z&&z.addEventListener("keypress",function(e){e.key==="Enter"&&ne()});const G=document.getElementById("pseudo");G&&G.addEventListener("keypress",function(e){e.key==="Enter"&&oe()});const X=document.getElementById("inviteEmail");X&&X.addEventListener("keypress",function(e){e.key==="Enter"&&me()});async function He(e){const t=document.getElementById(`comments-${e}`);t&&(t.style.display==="none"||t.style.display===""?(t.style.display="block",ie(e)):t.style.display="none")}async function ie(e){try{const[t,n]=await Promise.all([fetch(`${d}/api/comments/${c}/${e}`).then(o=>o.json()),de(e)]),s=ae(t);Fe(e,t),D(e,t.length,n.new_comments,s),s&&await Je(e,s)}catch(t){console.error("Erreur lors du chargement des commentaires:",t)}}async function re(e){try{const[t,n]=await Promise.all([fetch(`${d}/api/comments/${c}/${e}`).then(i=>i.json()),de(e)]),s=document.getElementById(`comment-badge-${e}`),o=ae(t);if(!s)return;ue(s,t.length),D(e,t.length,n.new_comments,o)}catch(t){console.error("Erreur lors du chargement du badge:",t)}}function Fe(e,t){const n=document.getElementById(`comments-list-${e}`);if(t.length===0){n.innerHTML='<div class="text-muted small">Aucun commentaire</div>',D(e,0,0,0),W(e);return}n.innerHTML=t.map(s=>{const o=s.created_at?Ze(s.created_at):"";return`
        <div class="comment-item">
            <div class="comment-pseudo">${C(s.pseudo)}</div>
            <div>${C(s.text)}</div>
            ${o?`<div class="text-muted small fst-italic mt-1">${o}</div>`:""}
        </div>
        `}).join(""),W(e)}function ae(e){return!Array.isArray(e)||e.length===0?0:e.reduce((t,n)=>{const s=Number(n==null?void 0:n.id)||0;return s>t?s:t},0)}async function le(e){const t=document.getElementById(`comment-input-${e}`);if(!t)return;const n=t.value.trim(),s=E();if(!n){a("Veuillez entrer un commentaire");return}if(!s){a("Veuillez d'abord entrer votre pseudo");return}try{(await fetch(`${d}/api/comments/${c}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,pseudo:s})})).ok&&(t.value="",ie(e),re(e))}catch(o){console.error("Erreur:",o),a("Erreur lors de l'ajout du commentaire")}}function W(e){const t=document.getElementById(`comment-input-${e}`);!t||t.dataset.enterHandler==="true"||(t.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),le(e))}),t.dataset.enterHandler="true")}async function ce(){const e=(window.adminEmail||"").toLowerCase(),t=(window.userEmail||p()||"").trim().toLowerCase();if(!(!e||!t||e!==t)&&!(M||_)){_=!0;try{const n=await fetch(`${d}/api/update/check`);if(!n.ok)return;const s=await n.json();if(!s.success||(M=!0,!s.has_update))return;const o=document.getElementById("updateLinkContainer"),i=document.getElementById("updateLink");if(!o||!i)return;const r=[];s.remote_tag&&r.push(s.remote_tag),s.remote_name&&r.push(s.remote_name);const l=r.join(" - ");i.textContent=l?`Mettre à jour l'application (${l})`:"Mettre à jour l'application",i.classList.remove("d-none"),o.classList.remove("d-none")}catch(n){console.error("Erreur lors de la vérification de mise à jour:",n)}finally{_=!1}}}function qe(e,t){const n=document.getElementById(`comment-button-${e}`);n&&(n.classList.remove("btn-outline-secondary","btn-outline-primary"),t>0?n.classList.add("btn-outline-primary"):n.classList.add("btn-outline-secondary"))}function D(e,t,n,s){qe(e,t);const o=document.getElementById(`comment-new-badge-${e}`);o&&(ue(o,n),o.dataset.lastCommentId=String(s||""))}async function Je(e,t){const n=p();if(!n||!c||!t)return 0;try{const s=await fetch(`${d}/api/subscribers/${c}/todos/${e}/last-comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,comment_id:t})});if(!s.ok)return 0;const o=await s.json();return Number((o==null?void 0:o.new_comments)||0)}catch(s){return console.error("Erreur lors de la mise à jour du dernier commentaire consulté:",s),0}}async function de(e){const t=p();if(!t||!c)return{stored_comment_id:0,new_comments:0};try{const n=await fetch(`${d}/api/subscribers/${c}/todos/${e}/last-comment?email=${encodeURIComponent(t)}`);return n.ok?await n.json():{stored_comment_id:0,new_comments:0}}catch(n){return console.error("Erreur lors de la récupération du dernier commentaire consulté:",n),{stored_comment_id:0,new_comments:0}}}function ue(e,t){e&&(e.textContent=t>0?t:"",e.classList.toggle("d-none",t===0))}async function Q(){const e=I.get("title");let t="SimpleTodo";if(e){t=decodeURIComponent(e),document.getElementById("listTitle").textContent=t,localStorage.setItem(`simpleTodo_list_${c}`,JSON.stringify({listId:c,title:t}));const o=p();try{if(await fetch(`${d}/api/lists/${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,creator_email:o})}),o){window.isListCreator=!0,console.log("isListCreator set to true (new list creation)"),$(o);try{const i=E()||"Créateur";await fetch(`${d}/api/subscribers/${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,pseudo:i})})}catch(i){console.error("Erreur abonnement auto:",i)}}}catch(i){console.error("Erreur sauvegarde liste:",i)}return K(),ce(),t}const n=p(),s=n?`${d}/api/lists/${c}?email=${encodeURIComponent(n)}`:`${d}/api/lists/${c}`;try{const i=await(await fetch(s)).json();t=i.title||"SimpleTodo",window.isListCreator=i.is_creator,window.isSubscriber=i.is_subscriber||!1,window.autoAssignToCreator=i.auto_assign_to_creator||!1,window.adminEmail=(i.admin_email||"").toLowerCase(),console.log("isListCreator from API:",window.isListCreator),console.log("isSubscriber from API:",window.isSubscriber),console.log("autoAssignToCreator from API:",window.autoAssignToCreator),console.log("Creator email from API:",i.creator_email),window.isListCreator&&!p()&&i.creator_email&&($(i.creator_email),console.log("Creator email set from API:",i.creator_email));const r=document.getElementById("autoAssignToCreator");r&&(r.checked=window.autoAssignToCreator),K(),O();const l=document.getElementById("listTitle");l&&(l.textContent=t)}catch(o){console.error("Erreur lors du chargement du titre:",o);const i=document.getElementById("listTitle");i&&(i.textContent="SimpleTodo")}return t}function Re(){const e=document.getElementById("titleInput"),t=document.getElementById("titleField");t.value=document.getElementById("listTitle").textContent,e.style.display="block"}function Ve(){document.getElementById("titleInput").style.display="none"}function K(){console.log("updateDeleteButton called, isListCreator:",window.isListCreator);const e=document.getElementById("deleteListBtnSettings");e&&window.isListCreator?e.classList.remove("d-none"):e&&e.classList.add("d-none");const t=document.querySelectorAll(".creator-only");console.log("Found",t.length,"creator-only sections"),t.forEach(o=>{window.isListCreator?(o.classList.add("show"),o.classList.remove("d-none")):(o.classList.remove("show"),o.classList.add("d-none"))});const n=document.getElementById("updateLinkContainer"),s=document.getElementById("updateLink");window.isListCreator?(n&&n.classList.add("d-none"),s&&s.classList.add("d-none"),ce()):(n&&n.classList.add("d-none"),s&&s.classList.add("d-none"),M=!1)}async function ze(){await w(`Attention : Cette action est irréversible !

Voulez-vous vraiment supprimer cette liste et toutes ses tâches ?`)&&await Ge()}async function Ge(){const e=p();if(!e){a("Erreur : Email non trouvé");return}try{const t=`${d}/api/lists/${c}?email=${encodeURIComponent(e)}`,n=await fetch(t,{method:"DELETE"});if(n.ok)a("Liste supprimée avec succès"),te();else{const s=await n.json();a(s.error||"Erreur lors de la suppression de la liste")}}catch(t){console.error("Erreur:",t),a("Erreur lors de la suppression de la liste")}}async function Xe(){const t=document.getElementById("titleField").value.trim();if(!t){a("Veuillez entrer un titre");return}try{const n=p(),s=n?`${d}/api/lists/${c}?email=${encodeURIComponent(n)}`:`${d}/api/lists/${c}`;(await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t})})).ok?(document.getElementById("listTitle").textContent=t,document.getElementById("titleInput").style.display="none"):a("Erreur lors de la sauvegarde du titre")}catch(n){console.error("Erreur:",n),a("Erreur lors de la sauvegarde du titre")}}function We(){if(!c){a("Aucune liste sélectionnée");return}const t=`${window.location.origin}/?list=${c}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{a(`Lien copié dans le presse-papiers !

`+t)}).catch(n=>{console.error("Erreur lors de la copie:",n),Y(t)}):Y(t)}function Y(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),a(`Lien copié dans le presse-papiers !

`+e)}catch(n){console.error("Erreur lors de la copie:",n),prompt("Copiez ce lien manuellement:",e)}document.body.removeChild(t)}function O(){const e=p(),t=document.getElementById("emailSubscription"),n=document.getElementById("emailUnsubscribe"),s=document.getElementById("emailDisplay");if(!e){t&&(t.style.display="block"),n&&(n.style.display="none");return}window.isSubscriber?(s&&(s.textContent=e),n&&(n.style.display="block"),t&&(t.style.display="none")):(s&&(s.textContent=""),t&&(t.style.display="block"),n&&(n.style.display="none"))}async function U(){const e=document.getElementById("email"),t=e.value.trim();if(!t||!t.includes("@"))return;const n=E();try{(await fetch(`${d}/api/subscribers/${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,pseudo:n})})).ok&&($(t),e.value="",window.isSubscriber=!0,O(),L(),N())}catch(s){console.error("Erreur:",s),a("Erreur lors de l'inscription")}}async function Qe(){const e=p();if(e)try{(await fetch(`${d}/api/subscribers/${c}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).ok&&(document.getElementById("email").value="",window.isSubscriber=!1,O(),L(),N())}catch(t){console.error("Erreur:",t),a("Erreur lors de la désinscription")}}async function N(){try{const t=await(await fetch(`${d}/api/subscribers/${c}`)).json();await Ke(t)}catch(e){console.error("Erreur:",e);const t=document.getElementById("subscribersList");t&&(t.innerHTML='<div class="text-white small text-center py-2">Erreur de chargement</div>')}}async function Ke(e){const t=document.getElementById("subscribersList");if(!t)return;if(e.length===0){t.innerHTML='<div class="text-white small text-center py-2"><i class="bi bi-inbox"></i> Aucun abonné pour le moment</div>';return}let n=null;console.log("displaySubscribers - isListCreator:",window.isListCreator);try{const s=p(),o=s?`${d}/api/lists/${c}?email=${encodeURIComponent(s)}`:`${d}/api/lists/${c}`,r=await(await fetch(o)).json();n=r.creator_email,console.log("Creator email from API:",n),r.is_creator!==void 0&&(window.isListCreator=r.is_creator,console.log("isListCreator from API:",window.isListCreator))}catch(s){console.error("Erreur récupération email créateur:",s)}t.innerHTML=e.map(s=>{const o=n&&n.trim()===s.email.trim();return console.log("Subscriber:",s.email,"Creator email:",n,"isCreator:",o),`
        <div class="d-flex align-items-center justify-content-between py-1">
            <div>
                <small class="text-white">
                    ${o?'<i class="bi bi-star-fill text-warning me-1" title="Créateur"></i>':""}
                    ${C(s.pseudo||s.email)} 
                    ${s.pseudo?`<span class="text-white">(${C(s.email)})</span>`:""}
                </small>
            </div>
            <button class="btn btn-sm btn-light" onclick="resendSubscriberLink(${s.id})" title="Renvoyer le lien">
                <i class="bi bi-send"></i>
            </button>
        </div>
        `}).join("")}async function Ye(e){try{(await fetch(`${d}/api/subscribers/${c}/${e}/resend`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok}catch(t){console.error("Erreur:",t)}}async function me(){const e=document.getElementById("inviteEmail"),t=e.value.trim();if(!t||!t.includes("@"))return;const n=E();try{(await fetch(`${d}/api/invitations/${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,invited_by:n||"Quelqu'un"})})).ok&&(e.value="")}catch(s){console.error("Erreur:",s)}}function Ze(e){const t=new Date(e),s=new Date-t;if(s<6e4)return"À l'instant";if(s<36e5){const o=Math.floor(s/6e4);return`Il y a ${o} minute${o>1?"s":""}`}if(s<864e5){const o=Math.floor(s/36e5);return`Il y a ${o} heure${o>1?"s":""}`}if(s<6048e5){const o=Math.floor(s/864e5);return`Il y a ${o} jour${o>1?"s":""}`}return t.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}let x=[];async function H(){try{x=await(await fetch(`${d}/api/categories/${c}`)).json()}catch(e){console.error("Erreur lors du chargement des catégories:",e)}}async function et(){try{const e=await fetch(`${d}/api/email-queue/process`,{method:"POST"});if(e.ok){const t=await e.json();t.processed>0&&console.log(`Emails traités: ${t.sent} envoyés, ${t.failed} échoués`)}}catch{}}async function F(){const e=document.getElementById("categoriesContainer");if(e.innerHTML="",x.length===0){e.innerHTML='<div class="text-muted text-white small">Aucune catégorie</div>';return}x.forEach(t=>{const n=document.createElement("div");n.className="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom border-white",n.innerHTML=`
            <div class="d-flex align-items-center">
                <span class="badge rounded-pill me-2" style="background-color: ${t.color}; color: white;">
                    ${C(t.name)}
                </span>
            </div>
            <button class="btn btn-sm btn-outline-light" onclick="deleteCategory(${t.id})">
                <i class="bi bi-trash"></i>
            </button>
        `,e.appendChild(n)})}async function tt(){const e=document.getElementById("newCategoryName").value.trim(),t=document.getElementById("newCategoryColor").value;if(!e){a("Veuillez entrer un nom de catégorie");return}try{(await fetch(`${d}/api/categories/${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,color:t})})).ok&&(document.getElementById("newCategoryName").value="",H(),F())}catch(n){console.error("Erreur:",n),a("Erreur lors de l'ajout de la catégorie")}}async function nt(e){if(await w("Supprimer cette catégorie ?"))try{(await fetch(`${d}/api/categories/${c}/${e}`,{method:"DELETE"})).ok&&(H(),F())}catch(n){console.error("Erreur:",n)}}
