#!/usr/bin/env bash

set -euo pipefail

# Aller à la racine du projet (emplacement du script)
cd "$(dirname "$0")"

echo "=== Installation SimpleTodo ==="
echo "Répertoire: $(pwd)"

if ! command -v composer >/dev/null 2>&1; then
    echo "Erreur : composer est requis mais introuvable." >&2
    exit 1
fi

if ! command -v npm >/dev/null 2>&1; then
    echo "Erreur : npm est requis mais introuvable." >&2
    exit 1
fi

if ! command -v php >/dev/null 2>&1; then
    echo "Erreur : php est requis mais introuvable." >&2
    exit 1
fi

echo "1/3 Composer install..."
composer install --no-interaction --prefer-dist

echo "2/3 Build des assets..."
npm install
npm run build

echo "3/3 Migration de la base..."
php artisan migrate --force

echo "✅ Installation terminée."

